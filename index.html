<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>17å²å¢è‚Œé•¿é«˜æ‰“å¡ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        h2 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        h3 {
            color: #555;
            margin: 15px 0 10px 0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #667eea;
            outline: none;
        }
        
        textarea {
            height: 100px;
            resize: vertical;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background: #6c757d;
            margin-left: 10px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .counter {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .counter-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }
        
        .counter-display {
            font-size: 24px;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
            line-height: 40px;
        }
        
        .record-item {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 0 8px 8px 0;
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .record-date {
            font-weight: bold;
            color: #667eea;
        }
        
        .record-content {
            color: #555;
            line-height: 1.6;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-box {
            background: #f0f2ff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .nutrition-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .meal-box {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
        }
        
        @media (max-width: 600px) {
            .nutrition-section {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
        
        .section-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid #667eea;
            color: #667eea;
            font-weight: bold;
        }
        
        .section-content {
            display: none;
        }
        
        .section-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ‹ï¸ é’å°‘å¹´å¢è‚Œé•¿é«˜æ‰“å¡ç³»ç»Ÿ</h1>
            <p>17å²ä¸“å± | å¯’å‡è‡ªå¾‹è®¡åˆ’ | æ¯æ—¥è·Ÿè¸ª</p>
        </header>
        
        <!-- é€‰é¡¹å¡å¯¼èˆª -->
        <div class="card">
            <div class="section-tabs">
                <div class="tab active" onclick="showSection('today')">ğŸ“ ä»Šæ—¥æ‰“å¡</div>
                <div class="tab" onclick="showSection('records')">ğŸ“Š æ‰“å¡è®°å½•</div>
                <div class="tab" onclick="showSection('plan')">ğŸ“‹ è®­ç»ƒè®¡åˆ’</div>
                <div class="tab" onclick="showSection('stats')">ğŸ“ˆ æ•°æ®ç»Ÿè®¡</div>
            </div>
            
            <!-- ä»Šæ—¥æ‰“å¡ -->
            <div id="today-section" class="section-content active">
                <h2>ğŸ“… ä»Šæ—¥æ‰“å¡ - <span id="today-date"></span></h2>
                
                <form id="tracking-form">
                    <!-- è¿åŠ¨æƒ…å†µ -->
                    <div class="form-group">
                        <h3>ğŸƒ ä»Šæ—¥è¿åŠ¨æƒ…å†µ</h3>
                        
                        <div class="form-group">
                            <label>å¼•ä½“å‘ä¸Šï¼ˆä¸ªï¼‰</label>
                            <div class="counter">
                                <button type="button" class="counter-btn" onclick="changeValue('pullups', -1)">-</button>
                                <span id="pullups-count" class="counter-display">0</span>
                                <button type="button" class="counter-btn" onclick="changeValue('pullups', 1)">+</button>
                            </div>
                            <input type="hidden" id="pullups" name="pullups" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label>ä¿¯å§æ’‘ï¼ˆä¸ªï¼‰</label>
                            <div class="counter">
                                <button type="button" class="counter-btn" onclick="changeValue('pushups', -1)">-</button>
                                <span id="pushups-count" class="counter-display">0</span>
                                <button type="button" class="counter-btn" onclick="changeValue('pushups', 1)">+</button>
                            </div>
                            <input type="hidden" id="pushups" name="pushups" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label>æ·±è¹²ï¼ˆä¸ªï¼‰</label>
                            <div class="counter">
                                <button type="button" class="counter-btn" onclick="changeValue('squats', -1)">-</button>
                                <span id="squats-count" class="counter-display">0</span>
                                <button type="button" class="counter-btn" onclick="changeValue('squats', 1)">+</button>
                            </div>
                            <input type="hidden" id="squats" name="squats" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label>æ‘¸é«˜è®­ç»ƒï¼ˆæ¬¡ï¼‰</label>
                            <input type="number" id="jumps" name="jumps" value="0" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label>è¿åŠ¨æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</label>
                            <input type="number" id="exerciseTime" name="exerciseTime" value="0" min="0" step="5">
                        </div>
                        
                        <div class="form-group">
                            <label>è¿åŠ¨æ„Ÿå— / å¤‡æ³¨</label>
                            <textarea id="exerciseNotes" name="exerciseNotes" placeholder="è®°å½•ä»Šå¤©çš„è¿åŠ¨æ„Ÿå—..."></textarea>
                        </div>
                    </div>
                    
                    <!-- é¥®é£Ÿè®°å½• -->
                    <div class="form-group">
                        <h3>ğŸ½ï¸ ä»Šæ—¥é¥®é£Ÿè®°å½•</h3>
                        
                        <div class="nutrition-section">
                            <div class="meal-box">
                                <h4>æ—©é¤</h4>
                                <textarea id="breakfast" name="breakfast" placeholder="ä¾‹ï¼šç‰›å¥¶250ml + é¸¡è›‹2ä¸ª + å…¨éº¦é¢åŒ…2ç‰‡ + è‹¹æœ1ä¸ª"></textarea>
                            </div>
                            
                            <div class="meal-box">
                                <h4>åˆé¤</h4>
                                <textarea id="lunch" name="lunch" placeholder="ä¾‹ï¼šç±³é¥­200g + é¸¡èƒ¸è‚‰150g + è”¬èœ250g + è±†è…100g"></textarea>
                            </div>
                            
                            <div class="meal-box">
                                <h4>æ™šé¤</h4>
                                <textarea id="dinner" name="dinner" placeholder="ä¾‹ï¼šç³™ç±³é¥­150g + é±¼è‚‰120g + è¥¿å…°èŠ±200g"></textarea>
                            </div>
                            
                            <div class="meal-box">
                                <h4>åŠ é¤/è¥å…»è¡¥å……</h4>
                                <textarea id="snacks" name="snacks" placeholder="ä¾‹ï¼šè›‹ç™½ç²‰1å‹º + åšæœ30g + é¦™è•‰1æ ¹"></textarea>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>é¥®æ°´é‡ï¼ˆmlï¼‰</label>
                            <input type="number" id="water" name="water" value="0" min="0">
                        </div>
                    </div>
                    
                    <!-- ç¡çœ è®°å½• -->
                    <div class="form-group">
                        <h3>ğŸ˜´ ç¡çœ è®°å½•</h3>
                        
                        <div class="form-group">
                            <label>ä¸ŠåºŠæ—¶é—´</label>
                            <input type="time" id="sleepTime" name="sleepTime" value="22:30">
                        </div>
                        
                        <div class="form-group">
                            <label>èµ·åºŠæ—¶é—´</label>
                            <input type="time" id="wakeTime" name="wakeTime" value="07:00">
                        </div>
                        
                        <div class="form-group">
                            <label>ç¡çœ è´¨é‡</label>
                            <select id="sleepQuality" name="sleepQuality">
                                <option value="5">â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸ éå¸¸å¥½</option>
                                <option value="4">â­ï¸â­ï¸â­ï¸â­ï¸ è‰¯å¥½</option>
                                <option value="3">â­ï¸â­ï¸â­ï¸ ä¸€èˆ¬</option>
                                <option value="2">â­ï¸â­ï¸ è¾ƒå·®</option>
                                <option value="1">â­ï¸ å¾ˆå·®</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- èº«é«˜ä½“é‡è®°å½• -->
                    <div class="form-group">
                        <h3>ğŸ“ èº«ä½“æ•°æ®ï¼ˆæ¯å‘¨è®°å½•ï¼‰</h3>
                        
                        <div class="form-group">
                            <label>å½“å‰èº«é«˜ï¼ˆcmï¼‰</label>
                            <input type="number" id="height" name="height" step="0.1" placeholder="175.5">
                        </div>
                        
                        <div class="form-group">
                            <label>å½“å‰ä½“é‡ï¼ˆkgï¼‰</label>
                            <input type="number" id="weight" name="weight" step="0.1" placeholder="65.2">
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button type="button" class="btn" onclick="saveRecord()">ğŸ’¾ ä¿å­˜ä»Šæ—¥è®°å½•</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">ğŸ”„ é‡ç½®è¡¨å•</button>
                    </div>
                </form>
            </div>
            
            <!-- æ‰“å¡è®°å½• -->
            <div id="records-section" class="section-content">
                <h2>ğŸ“Š å†å²æ‰“å¡è®°å½•</h2>
                <div class="btn-group">
                    <button class="btn" onclick="exportData()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
                    <button class="btn btn-secondary" onclick="importData()">ğŸ“¤ å¯¼å…¥æ•°æ®</button>
                    <input type="file" id="import-file" style="display:none" accept=".json">
                </div>
                <div id="records-list"></div>
            </div>
            
            <!-- è®­ç»ƒè®¡åˆ’ -->
            <div id="plan-section" class="section-content">
                <h2>ğŸ“‹ 17å²å¢è‚Œé•¿é«˜è®­ç»ƒè®¡åˆ’</h2>
                
                <div class="form-group">
                    <h3>ğŸ€ æ¯æ—¥åŸºç¡€è®­ç»ƒï¼ˆæ—©ä¸Šï¼‰</h3>
                    <ul style="padding-left: 20px; margin-bottom: 15px;">
                        <li>çƒ­èº«ï¼šåŠ¨æ€æ‹‰ä¼¸ 10åˆ†é’Ÿ</li>
                        <li>æ‘¸é«˜è®­ç»ƒï¼š3ç»„Ã—15æ¬¡</li>
                        <li>è·³ç»³ï¼š5åˆ†é’ŸÃ—2ç»„</li>
                        <li>æ‚¬æŒ‚å•æ ï¼š3ç»„Ã—30ç§’</li>
                    </ul>
                    
                    <h3>ğŸ’ª åŠ›é‡è®­ç»ƒï¼ˆä¸‹åˆ/æ™šä¸Šï¼‰</h3>
                    <ul style="padding-left: 20px; margin-bottom: 15px;">
                        <li>å‘¨ä¸€/å››ï¼šä¸Šè‚¢æ—¥ - å¼•ä½“å‘ä¸Šã€ä¿¯å§æ’‘ã€å“‘é“ƒæ¨ä¸¾</li>
                        <li>å‘¨äºŒ/äº”ï¼šä¸‹è‚¢æ—¥ - æ·±è¹²ã€ç®­æ­¥è¹²ã€æè¸µ</li>
                        <li>å‘¨ä¸‰/å…­ï¼šæ ¸å¿ƒæ—¥ - å¹³æ¿æ”¯æ’‘ã€å·è…¹ã€ä¿„ç½—æ–¯è½¬ä½“</li>
                        <li>å‘¨æ—¥ï¼šä¼‘æ¯æ—¥</li>
                    </ul>
                    
                    <h3>ğŸ è¥å…»ç›®æ ‡</h3>
                    <ul style="padding-left: 20px; margin-bottom: 15px;">
                        <li>æ¯æ—¥è›‹ç™½è´¨ï¼š1.5-2g/kgä½“é‡</li>
                        <li>é’™æ‘„å…¥ï¼š1000-1200mg/å¤©ï¼ˆç‰›å¥¶ã€è±†è…ã€ç»¿å¶è”¬èœï¼‰</li>
                        <li>ç»´ç”Ÿç´ Dï¼šå¤šæ™’å¤ªé˜³æˆ–è¡¥å……å‰‚</li>
                        <li>é¥®æ°´ï¼š2000-3000ml/å¤©</li>
                    </ul>
                    
                    <h3>ğŸ˜´ ç¡çœ è¦æ±‚</h3>
                    <ul style="padding-left: 20px;">
                        <li>ç›®æ ‡ç¡çœ ï¼š8-9å°æ—¶/å¤©</li>
                        <li>æœ€ä½³å…¥ç¡æ—¶é—´ï¼š22:00-23:00</li>
                        <li>ç”Ÿé•¿æ¿€ç´ åˆ†æ³Œé«˜å³°æœŸï¼š23:00-02:00</li>
                    </ul>
                </div>
            </div>
            
            <!-- æ•°æ®ç»Ÿè®¡ -->
            <div id="stats-section" class="section-content">
                <h2>ğŸ“ˆ è®­ç»ƒæ•°æ®ç»Ÿè®¡</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="total-days">0</div>
                        <div class="stat-label">æ‰“å¡å¤©æ•°</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="total-pullups">0</div>
                        <div class="stat-label">å¼•ä½“å‘ä¸Šæ€»æ•°</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="total-pushups">0</div>
                        <div class="stat-label">ä¿¯å§æ’‘æ€»æ•°</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="total-squats">0</div>
                        <div class="stat-label">æ·±è¹²æ€»æ•°</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avg-sleep">0</div>
                        <div class="stat-label">å¹³å‡ç¡çœ (å°æ—¶)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avg-water">0</div>
                        <div class="stat-label">å¹³å‡é¥®æ°´é‡(ml)</div>
                    </div>
                </div>
                
                <h3 style="margin-top: 30px;">ğŸ“… æœ€è¿‘7å¤©è®­ç»ƒè¶‹åŠ¿</h3>
                <div id="chart-container" style="margin-top: 20px; height: 300px;">
                    <canvas id="trend-chart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let records = [];
        let chart = null;
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®ä»Šæ—¥æ—¥æœŸ
            const today = new Date();
            document.getElementById('today-date').textContent = 
                today.getFullYear() + 'å¹´' + 
                (today.getMonth() + 1) + 'æœˆ' + 
                today.getDate() + 'æ—¥';
            
            // åŠ è½½ä¿å­˜çš„è®°å½•
            loadRecords();
            
            // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²æ‰“å¡
            checkTodayRecord();
            
            // æ˜¾ç¤ºç»Ÿè®¡
            updateStats();
        });
        
        // æ˜¾ç¤ºä¸åŒéƒ¨åˆ†
        function showSection(sectionId) {
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // éšè—æ‰€æœ‰å†…å®¹
            document.querySelectorAll('.section-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // æ¿€æ´»å½“å‰æ ‡ç­¾
            event.target.classList.add('active');
            
            // æ˜¾ç¤ºå¯¹åº”å†…å®¹
            document.getElementById(sectionId + '-section').classList.add('active');
            
            // å¦‚æœæ˜¯ç»Ÿè®¡éƒ¨åˆ†ï¼Œæ›´æ–°å›¾è¡¨
            if (sectionId === 'stats') {
                updateChart();
            }
        }
        
        // è®¡æ•°å™¨åŠŸèƒ½
        function changeValue(type, delta) {
            const display = document.getElementById(type + '-count');
            const input = document.getElementById(type);
            let value = parseInt(display.textContent) + delta;
            value = Math.max(0, value);
            display.textContent = value;
            input.value = value;
        }
        
        // ä¿å­˜è®°å½•
        function saveRecord() {
            const today = new Date().toISOString().split('T')[0];
            
            // æ”¶é›†æ•°æ®
            const record = {
                date: today,
                timestamp: new Date().getTime(),
                exercise: {
                    pullups: parseInt(document.getElementById('pullups').value),
                    pushups: parseInt(document.getElementById('pushups').value),
                    squats: parseInt(document.getElementById('squats').value),
                    jumps: parseInt(document.getElementById('jumps').value),
                    exerciseTime: parseInt(document.getElementById('exerciseTime').value),
                    exerciseNotes: document.getElementById('exerciseNotes').value
                },
                nutrition: {
                    breakfast: document.getElementById('breakfast').value,
                    lunch: document.getElementById('lunch').value,
                    dinner: document.getElementById('dinner').value,
                    snacks: document.getElementById('snacks').value,
                    water: parseInt(document.getElementById('water').value)
                },
                sleep: {
                    sleepTime: document.getElementById('sleepTime').value,
                    wakeTime: document.getElementById('wakeTime').value,
                    sleepQuality: document.getElementById('sleepQuality').value
                },
                body: {
                    height: parseFloat(document.getElementById('height').value) || 0,
                    weight: parseFloat(document.getElementById('weight').value) || 0
                }
            };
            
            // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²æœ‰è®°å½•
            const existingIndex = records.findIndex(r => r.date === today);
            if (existingIndex >= 0) {
                if (confirm('ä»Šå¤©å·²æœ‰è®°å½•ï¼Œæ˜¯å¦æ›´æ–°ï¼Ÿ')) {
                    records[existingIndex] = record;
                } else {
                    return;
                }
            } else {
                records.push(record);
            }
            
            // æŒ‰æ—¥æœŸæ’åº
            records.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('fitnessRecords', JSON.stringify(records));
            
            // æ›´æ–°æ˜¾ç¤º
            loadRecords();
            updateStats();
            updateChart();
            
            alert('è®°å½•ä¿å­˜æˆåŠŸï¼');
            
            // è·³è½¬åˆ°è®°å½•é¡µé¢
            showSection('records');
        }
        
        // åŠ è½½è®°å½•
        function loadRecords() {
            const saved = localStorage.getItem('fitnessRecords');
            if (saved) {
                records = JSON.parse(saved);
                displayRecords();
            }
        }
        
        // æ˜¾ç¤ºè®°å½•åˆ—è¡¨
        function displayRecords() {
            const container = document.getElementById('records-list');
            container.innerHTML = '';
            
            if (records.length === 0) {
                container.innerHTML = '<p>æš‚æ— æ‰“å¡è®°å½•ï¼Œå¼€å§‹ä½ çš„ç¬¬ä¸€å¤©å§ï¼</p>';
                return;
            }
            
            records.forEach(record => {
                const recordDiv = document.createElement('div');
                recordDiv.className = 'record-item';
                
                // è®¡ç®—ç¡çœ æ—¶é•¿
                const sleepTime = record.sleep.sleepTime.split(':');
                const wakeTime = record.sleep.wakeTime.split(':');
                const sleepHour = parseInt(sleepTime[0]);
                const sleepMinute = parseInt(sleepTime[1]);
                const wakeHour = parseInt(wakeTime[0]);
                const wakeMinute = parseInt(wakeTime[1]);
                
                let sleepDuration = wakeHour - sleepHour;
                if (wakeHour < sleepHour) {
                    sleepDuration += 24;
                }
                sleepDuration += (wakeMinute - sleepMinute) / 60;
                
                recordDiv.innerHTML = `
                    <div class="record-header">
                        <span class="record-date">${formatDate(record.date)}</span>
                        <span>ğŸ’¤ ${sleepDuration.toFixed(1)}å°æ—¶</span>
                    </div>
                    <div class="record-content">
                        <p><strong>è¿åŠ¨:</strong> å¼•ä½“å‘ä¸Š${record.exercise.pullups}ä¸ªï¼Œä¿¯å§æ’‘${record.exercise.pushups}ä¸ªï¼Œæ·±è¹²${record.exercise.squats}ä¸ªï¼Œè¿åŠ¨${record.exercise.exerciseTime}åˆ†é’Ÿ</p>
                        <p><strong>è¥å…»:</strong> é¥®æ°´${record.nutrition.water}ml</p>
                        <p><strong>èº«ä½“æ•°æ®:</strong> ${record.body.height > 0 ? 'èº«é«˜' + record.body.height + 'cm' : ''} ${record.body.weight > 0 ? 'ä½“é‡' + record.body.weight + 'kg' : ''}</p>
                        <p><strong>å¤‡æ³¨:</strong> ${record.exercise.exerciseNotes || 'æ— '}</p>
                    </div>
                `;
                
                container.appendChild(recordDiv);
            });
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.getFullYear() + 'å¹´' + 
                   (date.getMonth() + 1) + 'æœˆ' + 
                   date.getDate() + 'æ—¥';
        }
        
        // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²æ‰“å¡
        function checkTodayRecord() {
            const today = new Date().toISOString().split('T')[0];
            const todayRecord = records.find(r => r.date === today);
            
            if (todayRecord) {
                // å¡«å……è¡¨å•
                document.getElementById('pullups').value = todayRecord.exercise.pullups;
                document.getElementById('pullups-count').textContent = todayRecord.exercise.pullups;
                document.getElementById('pushups').value = todayRecord.exercise.pushups;
                document.getElementById('pushups-count').textContent = todayRecord.exercise.pushups;
                document.getElementById('squats').value = todayRecord.exercise.squats;
                document.getElementById('squats-count').textContent = todayRecord.exercise.squats;
                document.getElementById('jumps').value = todayRecord.exercise.jumps;
                document.getElementById('exerciseTime').value = todayRecord.exercise.exerciseTime;
                document.getElementById('exerciseNotes').value = todayRecord.exercise.exerciseNotes;
                document.getElementById('breakfast').value = todayRecord.nutrition.breakfast;
                document.getElementById('lunch').value = todayRecord.nutrition.lunch;
                document.getElementById('dinner').value = todayRecord.nutrition.dinner;
                document.getElementById('snacks').value = todayRecord.nutrition.snacks;
                document.getElementById('water').value = todayRecord.nutrition.water;
                document.getElementById('sleepTime').value = todayRecord.sleep.sleepTime;
                document.getElementById('wakeTime').value = todayRecord.sleep.wakeTime;
                document.getElementById('sleepQuality').value = todayRecord.sleep.sleepQuality;
                document.getElementById('height').value = todayRecord.body.height;
                document.getElementById('weight').value = todayRecord.body.weight;
            }
        }
        
        // æ¸…é™¤è¡¨å•
        function clearForm() {
            if (confirm('ç¡®å®šè¦é‡ç½®è¡¨å•å—ï¼Ÿ')) {
                document.getElementById('pullups').value = 0;
                document.getElementById('pullups-count').textContent = 0;
                document.getElementById('pushups').value = 0;
                document.getElementById('pushups-count').textContent = 0;
                document.getElementById('squats').value = 0;
                document.getElementById('squats-count').textContent = 0;
                document.getElementById('jumps').value = 0;
                document.getElementById('exerciseTime').value = 0;
                document.getElementById('exerciseNotes').value = '';
                document.getElementById('breakfast').value = '';
                document.getElementById('lunch').value = '';
                document.getElementById('dinner').value = '';
                document.getElementById('snacks').value = '';
                document.getElementById('water').value = 0;
                document.getElementById('sleepTime').value = '22:30';
                document.getElementById('wakeTime').value = '07:00';
                document.getElementById('sleepQuality').value = '3';
                document.getElementById('height').value = '';
                document.getElementById('weight').value = '';
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            if (records.length === 0) return;
            
            document.getElementById('total-days').textContent = records.length;
            
            const totalPullups = records.reduce((sum, r) => sum + r.exercise.pullups, 0);
            const totalPushups = records.reduce((sum, r) => sum + r.exercise.pushups, 0);
            const totalSquats = records.reduce((sum, r) => sum + r.exercise.squats, 0);
            
            document.getElementById('total-pullups').textContent = totalPullups;
            document.getElementById('total-pushups').textContent = totalPushups;
            document.getElementById('total-squats').textContent = totalSquats;
            
            // å¹³å‡ç¡çœ æ—¶é•¿
            let totalSleep = 0;
            records.forEach(record => {
                const sleepTime = record.sleep.sleepTime.split(':');
                const wakeTime = record.sleep.wakeTime.split(':');
                const sleepHour = parseInt(sleepTime[0]);
                const sleepMinute = parseInt(sleepTime[1]);
                const wakeHour = parseInt(wakeTime[0]);
                const wakeMinute = parseInt(wakeTime[1]);
                
                let sleepDuration = wakeHour - sleepHour;
                if (wakeHour < sleepHour) {
                    sleepDuration += 24;
                }
                sleepDuration += (wakeMinute - sleepMinute) / 60;
                
                totalSleep += sleepDuration;
            });
            
            document.getElementById('avg-sleep').textContent = (totalSleep / records.length).toFixed(1);
            
            // å¹³å‡é¥®æ°´é‡
            const avgWater = records.reduce((sum, r) => sum + r.nutrition.water, 0) / records.length;
            document.getElementById('avg-water').textContent = Math.round(avgWater);
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateChart() {
            const ctx = document.getElementById('trend-chart').getContext('2d');
            
            // è·å–æœ€è¿‘7å¤©æ•°æ®
            const recentRecords = [...records].sort((a, b) => new Date(a.date) - new Date(b.date)).slice(-7);
            
            const dates = recentRecords.map(r => r.date.substring(5)); // æ˜¾ç¤ºæœˆ-æ—¥
            const pullupsData = recentRecords.map(r => r.exercise.pullups);
            const pushupsData = recentRecords.map(r => r.exercise.pushups);
            const squatsData = recentRecords.map(r => r.exercise.squats);
            
            if (chart) {
                chart.destroy();
            }
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'å¼•ä½“å‘ä¸Š',
                            data: pullupsData,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'ä¿¯å§æ’‘',
                            data: pushupsData,
                            borderColor: '#764ba2',
                            backgroundColor: 'rgba(118, 75, 162, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'æ·±è¹²',
                            data: squatsData,
                            borderColor: '#4caf50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'æ•°é‡ï¼ˆä¸ªï¼‰'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'æ—¥æœŸ'
                            }
                        }
                    }
                }
            });
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const dataStr = JSON.stringify(records, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `å¥èº«æ‰“å¡è®°å½•_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // å¯¼å…¥æ•°æ®
        function importData() {
            document.getElementById('import-file').click();
        }
        
        // å¤„ç†æ–‡ä»¶å¯¼å…¥
        document.getElementById('import-file').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedRecords = JSON.parse(e.target.result);
                    if (Array.isArray(importedRecords)) {
                        if (confirm(`ç¡®è®¤å¯¼å…¥${importedRecords.length}æ¡è®°å½•å—ï¼Ÿè¿™å°†è¦†ç›–ç°æœ‰æ•°æ®ã€‚`)) {
                            records = importedRecords;
                            localStorage.setItem('fitnessRecords', JSON.stringify(records));
                            loadRecords();
                            updateStats();
                            updateChart();
                            alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                        }
                    } else {
                        alert('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
                    }
                } catch (error) {
                    alert('è¯»å–æ–‡ä»¶å¤±è´¥ï¼š' + error.message);
                }
            };
            reader.readAsText(file);
            
            // æ¸…é™¤æ–‡ä»¶è¾“å…¥
            event.target.value = '';
        });
    </script>
</body>
</html>
